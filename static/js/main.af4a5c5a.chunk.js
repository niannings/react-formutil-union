(this["webpackJsonpreact-formutil-union-example"]=this["webpackJsonpreact-formutil-union-example"]||[]).push([[0],{133:function(e,t,n){e.exports=n(217)},134:function(e,t,n){},214:function(e,t,n){},217:function(e,t,n){"use strict";n.r(t);n(134);var r=n(0),u=n.n(r),a=n(29),c=n.n(a),o=n(70),i=n(225),l=n(128),s=n(226),f=n(42);function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var p=0;var b=Object(r.createContext)((function(){return{}})),y=function(){function e(){this.pool={},this.oncePool={}}var t=e.prototype;return t.listen=function(e,t,n,r){var u=0===e?this.pool:this.oncePool,a=u[t];a||(a=u[t]={queue:[],taged:{}}),r?a.taged[r]=n:a.queue.push(n)},t.unlisten=function(e,t){var n=[this.pool,this.oncePool];return"string"===typeof t?n.reduce((function(n,r){if(e in r){var u=r[e];t in u.taged&&(delete u.taged[t],n--)}return n}),2):n.reduce((function(n,r){if(e in r){var u=r[e],a=u.queue.indexOf(t);a>-1&&(u.queue.splice(a,1),n+=u.queue.length)}return n}),0)},t.has=function(e,t){var n=[this.pool,this.oncePool];return"string"===typeof t?n.some((function(n){return e in n&&t in n[e].taged})):n.some((function(n){return e in n&&n[e].queue.includes(t)}))},t.on=function(e,t,n){this.listen(0,e,t,n)},t.once=function(e,t,n){this.listen(1,e,t,n)},t.emit=function(e,t){[this.pool,this.oncePool].forEach((function(n){var r=[];e in n&&(n[e].taged&&r.push.apply(r,Object.values(n[e].taged)),n[e].queue&&r.push.apply(r,n[e].queue)),r.forEach((function(e){return e(t)}))})),e in this.oncePool&&delete this.oncePool[e]},e}();function h(){return Object(r.useContext)(b)()}function E(){var e=h();Object(r.useMemo)((function(){if(!e.current)throw new Error("useFormUnion \u53ea\u80fd\u5728UnionForm\u7ec4\u4ef6\u4f5c\u7528\u57df\u4e0b\u4f7f\u7528")}),[e]);var t=Object(r.useRef)(),n=Object(r.useRef)(),u=Object(r.useRef)(),a=function(){var e=Object(r.useState)(0)[1];return Object(r.useCallback)((function(){return e((function(e){return e+1}))}),[])}();Object(r.useMemo)((function(){t.current=new Set,n.current=("w_"||"")+p++}),[]);var c=Object(r.useCallback)((function(r){var u=e.current.core,c=function(e){var r;null===(r=t.current)||void 0===r||r.add(e),u.deps.add(e),u.eventBus.on(e,a,n.current)};"string"===typeof r?c(r):r.forEach(c)}),[e,a]),o=Object(r.useCallback)((function(t){var r=e.current.core,u=function(e){0===r.eventBus.unlisten(e,n.current)&&r.deps.delete(e)};"string"===typeof t?u(t):t.forEach(u)}),[e]);return Object(r.useEffect)((function(){var t,r,a,c=e.current,o=c.core,i=c.utils;if(o.deps.size>0){for(var l,s=o.eventBus,f=i.getValues(),m={},v=d(o.deps);!(l=v()).done;){var p=l.value;m[p]=(a=f,p.split(/[.[\]]/g).filter(Boolean).reduce((function(e,t){return null===e||void 0===e?e:e[t]}),a))}(t=m,r=u.current||{},Object.keys(t).filter((function(e){return t[e]!==r[e]}))).forEach((function(e){s.has(e,n.current)||s.emit(e)})),u.current=m}})),Object(r.useEffect)((function(){return function(){for(var e,n=d(t.current);!(e=n()).done;){var r=e.value;o(r)}}}),[o]),{watch:c,noWatch:o}}function O(e,t){var n=h();return Object(r.useMemo)((function(){if(!n.current)throw new Error("useFormUnion \u53ea\u80fd\u5728UnionForm\u7ec4\u4ef6\u4f5c\u7528\u57df\u4e0b\u4f7f\u7528")}),[n]),Object(r.useEffect)((function(){var r=n.current.core;return e&&void 0!==t&&r.collect(t,e),function(){void 0!==t&&r.remove(t)}}),[n,e,t]),m({getForms:function(){return m({},n.current.core.collection)}},n.current.utils,E())}function g(e){var t=e.children,n=e.defaultValues,a=e.type,c=e.keys,o=Object(r.useRef)();Object(r.useMemo)((function(){if(o.current)o.current.core.type=a,o.current.core.defaultValues=n,o.current.core.keys=c;else{var e={};o.current={core:{collection:e,collect:function(t,n){return e[t]=n},remove:function(t){return delete e[t]},deps:new Set,eventBus:new y,type:a,defaultValues:n,keys:c},utils:{getValues:function(){var t={};return"array"===a&&(t=[]),"object"===a?Object.entries(e).reduce((function(e,t){return function(e,t,n){if(function(e){return null!==e&&void 0!==e}(e)&&t){for(var r=t.split(/[.[\]]/g).filter(Boolean),u=r.length,a=1;a<u;){var c=r[a-1],o=r[a];e[c]||(Number.isNaN(+o)?e[c]={}:e[c]=[]),e=e[c],a++}e[r[a-1]]=n}}(e,t[0],t[1].$params),e}),t):Object.entries(e).reduce((function(e,t){var n=t[0],r=t[1];return e[n]=r.$params,e}),t)},getValidStatus:function(){return Object.values(e).every((function(e){return e.$valid}))},batchDirty:function(t){return Object.values(e).forEach((function(e){return e.$batchDirty(t)}))},getFirstError:function(){var t,n;return(Array.isArray(c)?(n=[].concat(c,Object.keys(e)),[].concat(new Set(n))):Object.keys(e)).some((function(n){var r=e[n];return r&&r.$invalid&&"function"===typeof r.$getFirstError&&(t=r.$getFirstError()),null===r||void 0===r?void 0:r.$invalid})),t},getUnionDefaultValues:function(){var e;return m({},null===(e=o.current)||void 0===e?void 0:e.core.defaultValues)}}}}}),[n,c,a]);var i=Object(r.useCallback)((function(){return o}),[]);return u.a.createElement(b.Provider,{value:i},t)}g.withHOC=function(e,t){var n=function(n){var a=m({},t,n),c=a.type,o=a.defaultValues,i=function(e,t){if(null==e)return{};var n,r,u={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(u[n]=e[n]);return u}(a,["type","defaultValues"]);return u.a.createElement(g,{type:c||"object",defaultValues:o},Object(r.createElement)(e,i))};return n.displayName="FormUnion."+(e.displayName||e.name||"Anonymous"),n};var j=g;n(214);function w(e){var t=e.children,n=e.siderLeft,r=e.siderRight;return u.a.createElement("div",{className:"layout"},n&&u.a.createElement("div",{className:"sider"},n),u.a.createElement("div",{className:"content"},t),r&&u.a.createElement("div",{className:"sider"},r))}var k=Object(o.withForm)((function(e){var t=e.index,n=Object(r.useMemo)((function(){return Array(20).fill(0)}),[]);return O(Object(o["useForm"])(),"form_".concat(t)),u.a.createElement(i.a,{gutter:24},n.map((function(e,n){var r=n+20*t;return u.a.createElement(f.a,{span:4,key:n},u.a.createElement(o.FormItem,{label:"\u8f93\u5165-".concat(r),name:"name_".concat(r)},r%2?u.a.createElement(l.a,{size:"small"}):u.a.createElement(s.a,{size:"small"})))})))}));var F=j.withHOC((function(){var e=Object(r.useMemo)((function(){return Array(100).fill(0)}),[]);return u.a.createElement(i.a,{gutter:24},u.a.createElement(f.a,{span:12,style:{background:"#eee"}},u.a.createElement(o.Form,null,(function(t){return u.a.createElement(w,{siderLeft:u.a.createElement("pre",null,JSON.stringify(t.$params,null,2))},u.a.createElement("h2",null,"\u5e38\u89c4\u5199\u6cd5"),u.a.createElement(i.a,{gutter:24},e.map((function(e,t){return u.a.createElement(f.a,{span:4,key:t},u.a.createElement(o.FormItem,{label:"\u8f93\u5165-".concat(t),name:"name_".concat(t)},t%2?u.a.createElement(l.a,{size:"small"}):u.a.createElement(s.a,{size:"small"})))}))))}))),u.a.createElement(f.a,{span:12},u.a.createElement(w,{siderRight:u.a.createElement(S,null)},u.a.createElement("h2",null,"\u4f7f\u7528FormUnion"),Array(5).fill(0).map((function(e,t){return u.a.createElement(k,{key:t,index:t})}))),u.a.createElement(S,null)))}),{type:"object"});function S(){var e=O(),t=e.watch,n=e.getValues,r=Object.values(n()).reduce((function(e,t){return Object.assign(e,t)}),{});return t("form_0.name_0"),u.a.createElement("pre",null,JSON.stringify(r,null,2))}var A=function(){return u.a.createElement(F,null)};n(215),n(216);c.a.render(u.a.createElement(A,null),document.getElementById("root"))}},[[133,1,2]]]);
//# sourceMappingURL=main.af4a5c5a.chunk.js.map